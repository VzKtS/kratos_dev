<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <defs>
    <linearGradient id="vrfGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blockGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2563EB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="finalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.25"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94A3B8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="600" fill="#0F172A"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#F8FAFC" font-family="Arial, sans-serif" font-size="22" font-weight="bold">KratOs Consensus Overview</text>
  <text x="450" y="55" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="12">Proof-of-Stake with VRF Selection + GRANDPA Finality</text>

  <!-- Time/Slot Timeline -->
  <rect x="50" y="80" width="800" height="40" rx="8" fill="#1E293B"/>
  <text x="70" y="105" fill="#94A3B8" font-family="Arial" font-size="11">Epoch 0</text>

  <!-- Slots -->
  <g>
    <rect x="130" y="85" width="60" height="30" rx="4" fill="#374151"/>
    <text x="160" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 0</text>
  </g>
  <g>
    <rect x="200" y="85" width="60" height="30" rx="4" fill="#374151"/>
    <text x="230" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 1</text>
  </g>
  <g>
    <rect x="270" y="85" width="60" height="30" rx="4" fill="url(#blockGrad)"/>
    <text x="300" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 2</text>
  </g>
  <g>
    <rect x="340" y="85" width="60" height="30" rx="4" fill="#374151"/>
    <text x="370" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 3</text>
  </g>
  <text x="420" y="105" fill="#64748B" font-family="Arial" font-size="14">...</text>
  <g>
    <rect x="450" y="85" width="80" height="30" rx="4" fill="#374151"/>
    <text x="490" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 599</text>
  </g>

  <text x="560" y="105" fill="#94A3B8" font-family="Arial" font-size="11">Epoch 1</text>
  <g>
    <rect x="620" y="85" width="60" height="30" rx="4" fill="#374151"/>
    <text x="650" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Slot 0</text>
  </g>
  <text x="710" y="105" fill="#64748B" font-family="Arial" font-size="14">...</text>

  <!-- Slot duration annotation -->
  <text x="790" y="105" fill="#64748B" font-family="Arial" font-size="9">6s/slot</text>

  <!-- VRF Selection Layer -->
  <g filter="url(#shadow)">
    <rect x="50" y="150" width="380" height="180" rx="10" fill="url(#vrfGrad)"/>
    <text x="240" y="180" text-anchor="middle" fill="white" font-family="Arial" font-size="16" font-weight="bold">VRF Slot Selection</text>
    <line x1="70" y1="190" x2="410" y2="190" stroke="rgba(255,255,255,0.3)"/>

    <!-- Formula -->
    <rect x="70" y="205" width="340" height="50" rx="6" fill="rgba(0,0,0,0.2)"/>
    <text x="240" y="225" text-anchor="middle" fill="white" font-family="monospace" font-size="11">weight = min(√stake, √1M) × ln(1 + VC)</text>
    <text x="240" y="245" text-anchor="middle" fill="white" font-family="monospace" font-size="10">STAKE_CAP = 1,000,000 KRAT</text>

    <text x="240" y="275" text-anchor="middle" fill="white" font-family="Arial" font-size="11">Deterministic selection per slot</text>
    <text x="240" y="290" text-anchor="middle" fill="white" font-family="Arial" font-size="10">VRFSelector::select_validator(slot, epoch)</text>

    <!-- Bootstrap note -->
    <rect x="70" y="305" width="340" height="20" rx="3" fill="rgba(245,158,11,0.3)"/>
    <text x="240" y="319" text-anchor="middle" fill="#FCD34D" font-family="Arial" font-size="9">Bootstrap: stake_component=10.0, 100 VC min</text>
  </g>

  <!-- Block Production Layer -->
  <g filter="url(#shadow)">
    <rect x="470" y="150" width="380" height="180" rx="10" fill="url(#blockGrad)"/>
    <text x="660" y="180" text-anchor="middle" fill="white" font-family="Arial" font-size="16" font-weight="bold">Block Production</text>
    <line x1="490" y1="190" x2="830" y2="190" stroke="rgba(255,255,255,0.3)"/>

    <!-- Steps -->
    <text x="510" y="215" fill="white" font-family="Arial" font-size="11">1. Check if slot leader (VRF)</text>
    <text x="510" y="240" fill="white" font-family="Arial" font-size="11">2. Collect transactions from mempool</text>
    <text x="510" y="265" fill="white" font-family="Arial" font-size="11">3. Execute transactions</text>
    <text x="510" y="290" fill="white" font-family="Arial" font-size="11">4. Apply block rewards (+12.37 KRAT)</text>
    <text x="510" y="315" fill="white" font-family="Arial" font-size="11">5. Sign block with Ed25519</text>
  </g>

  <!-- Arrow VRF to Block -->
  <path d="M 430 240 L 470 240" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Finality Layer -->
  <g filter="url(#shadow)">
    <rect x="200" y="370" width="500" height="120" rx="10" fill="url(#finalGrad)"/>
    <text x="450" y="400" text-anchor="middle" fill="white" font-family="Arial" font-size="16" font-weight="bold">GRANDPA-style Finality</text>
    <line x1="220" y1="410" x2="680" y2="410" stroke="rgba(255,255,255,0.3)"/>

    <text x="300" y="440" text-anchor="middle" fill="white" font-family="Arial" font-size="12">Pre-vote</text>
    <text x="300" y="460" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Validators vote</text>
    <text x="300" y="475" text-anchor="middle" fill="white" font-family="Arial" font-size="10">on best chain</text>

    <path d="M 370 450 L 430 450" stroke="white" stroke-width="2" marker-end="url(#arrow)"/>

    <text x="500" y="440" text-anchor="middle" fill="white" font-family="Arial" font-size="12">Pre-commit</text>
    <text x="500" y="460" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Commit with</text>
    <text x="500" y="475" text-anchor="middle" fill="white" font-family="Arial" font-size="10">2/3 majority</text>

    <path d="M 570 450 L 620 450" stroke="white" stroke-width="2" marker-end="url(#arrow)"/>

    <text x="660" y="450" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Final</text>
    <circle cx="660" cy="465" r="10" fill="white"/>
    <text x="660" y="469" text-anchor="middle" fill="#059669" font-family="Arial" font-size="10">✓</text>
  </g>

  <!-- Validators at bottom -->
  <g filter="url(#shadow)">
    <rect x="50" y="510" width="250" height="70" rx="8" fill="#1E293B"/>
    <text x="175" y="535" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Validator Set</text>
    <text x="175" y="555" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">Active validators with stake or 100+ VC</text>
    <text x="175" y="570" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">Max 100 during bootstrap</text>
  </g>

  <!-- Timing -->
  <g filter="url(#shadow)">
    <rect x="325" y="510" width="250" height="70" rx="8" fill="#1E293B"/>
    <text x="450" y="535" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Timing</text>
    <text x="450" y="555" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">Slot: 6 seconds | Epoch: 600 slots</text>
    <text x="450" y="570" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">1 hour per epoch | 8,760 epochs/year</text>
  </g>

  <!-- Rewards -->
  <g filter="url(#shadow)">
    <rect x="600" y="510" width="250" height="70" rx="8" fill="#1E293B"/>
    <text x="725" y="535" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Block Rewards</text>
    <text x="725" y="555" text-anchor="middle" fill="#10B981" font-family="Arial" font-size="10">~12.37 KRAT/block (6.5% annual)</text>
    <text x="725" y="570" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">+ VC bonus: ×(1 + ln(1+VC)/10)</text>
  </g>

  <!-- Source reference -->
  <text x="450" y="595" text-anchor="middle" fill="#475569" font-family="Arial" font-size="9">
    SPEC_3 Consensus | node/producer.rs | consensus/vrf_selection.rs
  </text>
</svg>
