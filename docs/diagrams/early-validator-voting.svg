<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 800">
  <defs>
    <linearGradient id="validatorG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366F1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="candidateG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="approvedG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="phaseG" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#10B981;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.25"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94A3B8"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="850" height="800" fill="#0F172A"/>

  <!-- Title -->
  <text x="425" y="35" text-anchor="middle" fill="#F8FAFC" font-family="Arial, sans-serif" font-size="22" font-weight="bold">Early Validator Voting System</text>
  <text x="425" y="55" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="12">Bootstrap Era: 3 votes required for approval</text>

  <!-- Phase indicator -->
  <rect x="50" y="75" width="750" height="25" rx="12" fill="#1E293B"/>
  <rect x="50" y="75" width="250" height="25" rx="12" fill="url(#phaseG)"/>
  <text x="175" y="92" text-anchor="middle" fill="white" font-family="Arial" font-size="11" font-weight="bold">Bootstrap Era (Active)</text>
  <text x="550" y="92" text-anchor="middle" fill="#64748B" font-family="Arial" font-size="11">Post-Bootstrap (Stake × VC Hybrid)</text>

  <!-- Existing Validators -->
  <g filter="url(#shadow)">
    <rect x="50" y="120" width="200" height="200" rx="10" fill="url(#validatorG)"/>
    <text x="150" y="150" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Active Validators</text>
    <line x1="65" y1="160" x2="235" y2="160" stroke="rgba(255,255,255,0.3)"/>

    <!-- Validator icons -->
    <circle cx="100" cy="200" r="25" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="2"/>
    <text x="100" y="205" text-anchor="middle" fill="white" font-family="Arial" font-size="11">V1</text>
    <text x="100" y="240" text-anchor="middle" fill="white" font-family="Arial" font-size="9">Genesis</text>

    <circle cx="150" cy="200" r="25" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="2"/>
    <text x="150" y="205" text-anchor="middle" fill="white" font-family="Arial" font-size="11">V2</text>
    <text x="150" y="240" text-anchor="middle" fill="white" font-family="Arial" font-size="9">Early</text>

    <circle cx="200" cy="200" r="25" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="2"/>
    <text x="200" y="205" text-anchor="middle" fill="white" font-family="Arial" font-size="11">V3</text>
    <text x="200" y="240" text-anchor="middle" fill="white" font-family="Arial" font-size="9">Early</text>

    <text x="150" y="280" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Can propose &amp; vote</text>
    <text x="150" y="295" text-anchor="middle" fill="white" font-family="Arial" font-size="10">100 VC each</text>
  </g>

  <!-- Step 1: Propose -->
  <g filter="url(#shadow)">
    <rect x="300" y="120" width="220" height="90" rx="8" fill="#1E293B" stroke="#F59E0B" stroke-width="2"/>
    <text x="410" y="145" text-anchor="middle" fill="#F59E0B" font-family="Arial" font-size="13" font-weight="bold">Step 1: Propose</text>
    <text x="410" y="170" text-anchor="middle" fill="white" font-family="Arial" font-size="11">ProposeEarlyValidator</text>
    <text x="410" y="190" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">Proposer counts as 1st vote</text>
    <text x="410" y="205" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">validators.propose_early_validator()</text>
  </g>

  <!-- Arrow from validators to propose -->
  <path d="M 250 180 L 300 165" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Pending Candidate -->
  <g filter="url(#shadow)">
    <rect x="570" y="120" width="230" height="120" rx="10" fill="url(#candidateG)"/>
    <text x="685" y="150" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Pending Candidate</text>
    <line x1="585" y1="160" x2="785" y2="160" stroke="rgba(255,255,255,0.3)"/>

    <circle cx="685" cy="200" r="30" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="685" y="205" text-anchor="middle" fill="white" font-family="Arial" font-size="14">?</text>
    <text x="685" y="235" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Candidate address</text>
  </g>

  <!-- Arrow from propose to candidate -->
  <path d="M 520 165 L 570 165" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2: Vote -->
  <g filter="url(#shadow)">
    <rect x="300" y="260" width="220" height="90" rx="8" fill="#1E293B" stroke="#6366F1" stroke-width="2"/>
    <text x="410" y="285" text-anchor="middle" fill="#818CF8" font-family="Arial" font-size="13" font-weight="bold">Step 2: Vote (x2)</text>
    <text x="410" y="310" text-anchor="middle" fill="white" font-family="Arial" font-size="11">VoteEarlyValidator</text>
    <text x="410" y="330" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">Other validators vote</text>
    <text x="410" y="345" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">validators.vote_early_validator()</text>
  </g>

  <!-- Arrows from validators to vote -->
  <path d="M 150 320 L 300 305" stroke="#6366F1" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M 200 320 L 300 305" stroke="#6366F1" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Vote counter -->
  <g filter="url(#shadow)">
    <rect x="570" y="260" width="230" height="90" rx="8" fill="#1E293B"/>
    <text x="685" y="285" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Vote Counter</text>

    <!-- Vote progress -->
    <rect x="600" y="305" width="170" height="20" rx="10" fill="#374151"/>
    <rect x="600" y="305" width="170" height="20" rx="10" fill="#10B981"/>
    <text x="685" y="320" text-anchor="middle" fill="white" font-family="Arial" font-size="11" font-weight="bold">3/3 votes</text>
    <text x="685" y="345" text-anchor="middle" fill="#10B981" font-family="Arial" font-size="10">Quorum reached!</text>
  </g>

  <!-- Arrow from vote to counter -->
  <path d="M 520 305 L 570 305" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3: Approval -->
  <g filter="url(#shadow)">
    <rect x="400" y="390" width="250" height="100" rx="10" fill="url(#approvedG)"/>
    <text x="525" y="420" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Step 3: Approval</text>
    <line x1="415" y1="430" x2="635" y2="430" stroke="rgba(255,255,255,0.3)"/>
    <text x="525" y="455" text-anchor="middle" fill="white" font-family="Arial" font-size="11">approve_early_validator()</text>
    <text x="525" y="475" text-anchor="middle" fill="white" font-family="Arial" font-size="11">initialize_bootstrap_vc(100)</text>
  </g>

  <!-- Arrow from counter to approval -->
  <path d="M 685 350 L 685 370 L 525 370 L 525 390" stroke="#10B981" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- New Active Validator -->
  <g filter="url(#shadow)">
    <rect x="350" y="520" width="300" height="120" rx="10" fill="url(#validatorG)" stroke="#10B981" stroke-width="3"/>
    <text x="500" y="550" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">New Active Validator</text>
    <line x1="365" y1="560" x2="635" y2="560" stroke="rgba(255,255,255,0.3)"/>

    <text x="500" y="585" text-anchor="middle" fill="white" font-family="Arial" font-size="11">100 VC initialized</text>
    <text x="500" y="605" text-anchor="middle" fill="white" font-family="Arial" font-size="11">VRF weight &gt; 0</text>
    <text x="500" y="625" text-anchor="middle" fill="#10B981" font-family="Arial" font-size="11">Can produce blocks!</text>
  </g>

  <!-- Arrow from approval to new validator -->
  <path d="M 525 490 L 500 520" stroke="#10B981" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- Two-Phase Execution Note -->
  <g filter="url(#shadow)">
    <rect x="50" y="380" width="270" height="140" rx="8" fill="#1E293B" stroke="#8B5CF6" stroke-width="1"/>
    <text x="185" y="405" text-anchor="middle" fill="#A78BFA" font-family="Arial" font-size="12" font-weight="bold">Two-Phase Execution</text>
    <line x1="65" y1="415" x2="305" y2="415" stroke="#374151"/>

    <text x="70" y="440" fill="#F59E0B" font-family="Arial" font-size="10" font-weight="bold">Phase 1: producer.rs</text>
    <text x="70" y="458" fill="#94A3B8" font-family="Arial" font-size="9">• Validate sender &amp; fees</text>
    <text x="70" y="473" fill="#94A3B8" font-family="Arial" font-size="9">• Defer execution → Ok()</text>

    <text x="70" y="495" fill="#10B981" font-family="Arial" font-size="10" font-weight="bold">Phase 2: service.rs</text>
    <text x="70" y="513" fill="#94A3B8" font-family="Arial" font-size="9">• Execute on ValidatorSet</text>
  </g>

  <!-- Requirements Box -->
  <g filter="url(#shadow)">
    <rect x="50" y="540" width="270" height="100" rx="8" fill="#1E293B"/>
    <text x="185" y="565" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Bootstrap Era Requirements</text>
    <line x1="65" y1="575" x2="305" y2="575" stroke="#374151"/>
    <text x="70" y="598" fill="#94A3B8" font-family="Arial" font-size="10">• 3 votes for quorum</text>
    <text x="70" y="618" fill="#94A3B8" font-family="Arial" font-size="10">• Only active validators can vote</text>
    <text x="70" y="638" fill="#94A3B8" font-family="Arial" font-size="10">• Max 100 validators</text>
  </g>

  <!-- VC Initialization Box -->
  <g>
    <rect x="680" y="520" width="140" height="120" rx="8" fill="#1E293B"/>
    <text x="750" y="545" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="11" font-weight="bold">VC Initialization</text>
    <line x1="695" y1="555" x2="805" y2="555" stroke="#374151"/>
    <text x="750" y="580" text-anchor="middle" fill="#10B981" font-family="Arial" font-size="24" font-weight="bold">100</text>
    <text x="750" y="600" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">uptime credits</text>
    <text x="750" y="620" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">Required for VRF</text>
    <text x="750" y="635" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">slot selection</text>
  </g>

  <!-- VRF Weight Formula Box -->
  <g filter="url(#shadow)">
    <rect x="50" y="660" width="750" height="60" rx="8" fill="#1E293B" stroke="#8B5CF6" stroke-width="1"/>
    <text x="425" y="685" text-anchor="middle" fill="#A78BFA" font-family="Arial" font-size="12" font-weight="bold">VRF Weight Formula (Both Eras)</text>
    <text x="425" y="705" text-anchor="middle" fill="#F8FAFC" font-family="monospace" font-size="11">weight = min(√stake, √1M) × ln(1 + VC)   |   Bootstrap: stake_component = 10.0 (≈100 KRAT)</text>
  </g>

  <!-- Files reference -->
  <text x="425" y="745" text-anchor="middle" fill="#64748B" font-family="Arial" font-size="10">
    consensus/validator.rs | consensus/vrf_selection.rs | node/service.rs
  </text>
  <text x="425" y="765" text-anchor="middle" fill="#64748B" font-family="Arial" font-size="10">
    SPEC_2 §4.2 (VRF) | SPEC_3 §13 | Synthesis §20, §29
  </text>
</svg>
