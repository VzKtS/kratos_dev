<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650">
  <defs>
    <linearGradient id="walletG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="rpcG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366F1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mempoolG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EC4899;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DB2777;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blockG" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.25"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94A3B8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="650" fill="#0F172A"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#F8FAFC" font-family="Arial, sans-serif" font-size="22" font-weight="bold">Transaction Flow</text>
  <text x="450" y="55" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="12">Wallet → RPC → Mempool → Block → Finality</text>

  <!-- Phase 1: Wallet -->
  <g filter="url(#shadow)">
    <rect x="30" y="100" width="160" height="180" rx="10" fill="url(#walletG)"/>
    <text x="110" y="130" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Wallet</text>
    <line x1="45" y1="140" x2="175" y2="140" stroke="rgba(255,255,255,0.3)"/>
    <text x="110" y="165" text-anchor="middle" fill="white" font-family="Arial" font-size="11">1. Build Transaction</text>
    <text x="110" y="190" text-anchor="middle" fill="white" font-family="Arial" font-size="11">2. bincode serialize</text>
    <text x="110" y="215" text-anchor="middle" fill="white" font-family="Arial" font-size="11">3. Domain separate</text>
    <text x="55" y="235" fill="white" font-family="Arial" font-size="9">KRATOS_TRANSACTION_V1:</text>
    <text x="110" y="260" text-anchor="middle" fill="white" font-family="Arial" font-size="11">4. Ed25519 sign</text>
  </g>

  <!-- Arrow 1 -->
  <path d="M 190 190 L 250 190" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="220" y="180" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">JSON-RPC</text>
  <text x="220" y="205" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="8">HTTP POST</text>

  <!-- Phase 2: RPC Server -->
  <g filter="url(#shadow)">
    <rect x="255" y="100" width="160" height="180" rx="10" fill="url(#rpcG)"/>
    <text x="335" y="130" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">RPC Server</text>
    <line x1="270" y1="140" x2="400" y2="140" stroke="rgba(255,255,255,0.3)"/>
    <text x="335" y="165" text-anchor="middle" fill="white" font-family="Arial" font-size="11">5. Parse JSON</text>
    <text x="335" y="190" text-anchor="middle" fill="white" font-family="Arial" font-size="11">6. Hex → bytes</text>
    <text x="335" y="215" text-anchor="middle" fill="white" font-family="Arial" font-size="11">7. Create RpcCall</text>
    <text x="335" y="240" text-anchor="middle" fill="white" font-family="Arial" font-size="11">8. Send via mpsc</text>
    <text x="335" y="265" text-anchor="middle" fill="white" font-family="Arial" font-size="9">SubmitTransaction(tx)</text>
  </g>

  <!-- Arrow 2 -->
  <path d="M 415 190 L 475 190" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="445" y="180" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">mpsc</text>
  <text x="445" y="205" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="8">channel</text>

  <!-- Phase 3: Node Service -->
  <g filter="url(#shadow)">
    <rect x="480" y="100" width="160" height="180" rx="10" fill="url(#nodeG)"/>
    <text x="560" y="130" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">NodeService</text>
    <line x1="495" y1="140" x2="625" y2="140" stroke="rgba(255,255,255,0.3)"/>
    <text x="560" y="165" text-anchor="middle" fill="white" font-family="Arial" font-size="11">9. Verify signature</text>
    <text x="560" y="190" text-anchor="middle" fill="white" font-family="Arial" font-size="11">10. Check nonce</text>
    <text x="560" y="215" text-anchor="middle" fill="white" font-family="Arial" font-size="11">11. Check balance</text>
    <text x="560" y="240" text-anchor="middle" fill="white" font-family="Arial" font-size="11">12. Auto-compute</text>
    <text x="560" y="265" text-anchor="middle" fill="white" font-family="Arial" font-size="9">tx.hash if missing</text>
  </g>

  <!-- Arrow 3 -->
  <path d="M 640 190 L 700 190" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Phase 4: Mempool -->
  <g filter="url(#shadow)">
    <rect x="705" y="100" width="160" height="180" rx="10" fill="url(#mempoolG)"/>
    <text x="785" y="130" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Mempool</text>
    <line x1="720" y1="140" x2="850" y2="140" stroke="rgba(255,255,255,0.3)"/>
    <text x="785" y="165" text-anchor="middle" fill="white" font-family="Arial" font-size="11">13. Store in pool</text>
    <text x="785" y="190" text-anchor="middle" fill="white" font-family="Arial" font-size="11">14. Priority queue</text>
    <text x="785" y="215" text-anchor="middle" fill="white" font-family="Arial" font-size="10">(by fee + nonce)</text>
    <text x="785" y="245" text-anchor="middle" fill="white" font-family="Arial" font-size="11">15. Wait for block</text>
    <text x="785" y="270" text-anchor="middle" fill="white" font-family="Arial" font-size="9">producer to pick</text>
  </g>

  <!-- Vertical connector -->
  <path d="M 785 280 L 785 340" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="800" y="315" fill="#94A3B8" font-family="Arial" font-size="9">next slot</text>

  <!-- Phase 5: Block Production -->
  <g filter="url(#shadow)">
    <rect x="480" y="350" width="385" height="130" rx="10" fill="url(#blockG)"/>
    <text x="672" y="380" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">Block Production</text>
    <line x1="495" y1="390" x2="850" y2="390" stroke="rgba(255,255,255,0.3)"/>

    <!-- Sub-steps -->
    <rect x="495" y="405" width="170" height="60" rx="6" fill="rgba(0,0,0,0.2)"/>
    <text x="580" y="425" text-anchor="middle" fill="white" font-family="Arial" font-size="10" font-weight="bold">TransactionExecutor</text>
    <text x="580" y="445" text-anchor="middle" fill="white" font-family="Arial" font-size="9">16. Execute call</text>
    <text x="580" y="458" text-anchor="middle" fill="white" font-family="Arial" font-size="9">17. Deduct fees</text>

    <rect x="680" y="405" width="170" height="60" rx="6" fill="rgba(0,0,0,0.2)"/>
    <text x="765" y="425" text-anchor="middle" fill="white" font-family="Arial" font-size="10" font-weight="bold">State Update</text>
    <text x="765" y="445" text-anchor="middle" fill="white" font-family="Arial" font-size="9">18. Update accounts</text>
    <text x="765" y="458" text-anchor="middle" fill="white" font-family="Arial" font-size="9">19. Compute state root</text>
  </g>

  <!-- Arrow to finality -->
  <path d="M 672 480 L 672 510" stroke="#94A3B8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Phase 6: Finality -->
  <g filter="url(#shadow)">
    <rect x="480" y="520" width="385" height="100" rx="10" fill="#374151" stroke="#10B981" stroke-width="2"/>
    <text x="672" y="550" text-anchor="middle" fill="#10B981" font-family="Arial" font-size="14" font-weight="bold">Finality</text>
    <text x="672" y="575" text-anchor="middle" fill="white" font-family="Arial" font-size="11">20. Block added to chain</text>
    <text x="672" y="595" text-anchor="middle" fill="white" font-family="Arial" font-size="11">21. Broadcast to peers</text>
    <text x="672" y="610" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="10">Transaction confirmed after 2/3 validator agreement</text>
  </g>

  <!-- Transaction Types Legend -->
  <g filter="url(#shadow)">
    <rect x="30" y="350" width="200" height="160" rx="8" fill="#1E293B"/>
    <text x="130" y="375" text-anchor="middle" fill="#F8FAFC" font-family="Arial" font-size="12" font-weight="bold">Transaction Types</text>
    <line x1="45" y1="385" x2="215" y2="385" stroke="#374151"/>
    <text x="50" y="405" fill="#10B981" font-family="Arial" font-size="10">Transfer</text>
    <text x="130" y="405" fill="#94A3B8" font-family="Arial" font-size="9">Send KRAT</text>
    <text x="50" y="425" fill="#F59E0B" font-family="Arial" font-size="10">ProposeValidator</text>
    <text x="160" y="425" fill="#94A3B8" font-family="Arial" font-size="9">Bootstrap</text>
    <text x="50" y="445" fill="#F59E0B" font-family="Arial" font-size="10">VoteValidator</text>
    <text x="145" y="445" fill="#94A3B8" font-family="Arial" font-size="9">Bootstrap</text>
    <text x="50" y="465" fill="#8B5CF6" font-family="Arial" font-size="10">Stake</text>
    <text x="90" y="465" fill="#94A3B8" font-family="Arial" font-size="9">Lock tokens</text>
    <text x="50" y="485" fill="#8B5CF6" font-family="Arial" font-size="10">Unstake</text>
    <text x="100" y="485" fill="#94A3B8" font-family="Arial" font-size="9">Unbond</text>
    <text x="50" y="505" fill="#EC4899" font-family="Arial" font-size="10">RegisterValidator</text>
  </g>

  <!-- Domain Separation Box -->
  <g filter="url(#shadow)">
    <rect x="255" y="350" width="200" height="100" rx="8" fill="#1E293B" stroke="#F59E0B" stroke-width="1"/>
    <text x="355" y="375" text-anchor="middle" fill="#F59E0B" font-family="Arial" font-size="11" font-weight="bold">Domain Separation</text>
    <text x="355" y="400" text-anchor="middle" fill="white" font-family="monospace" font-size="9">KRATOS_TRANSACTION_V1:</text>
    <text x="355" y="420" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">Prevents replay attacks</text>
    <text x="355" y="440" text-anchor="middle" fill="#94A3B8" font-family="Arial" font-size="9">across different contexts</text>
  </g>
</svg>
